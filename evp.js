const throttle=(e,t)=>{let r=!1;return(...o)=>{r||(e(...o),r=!0,setTimeout((()=>{r=!1}),t))}},debounce=(e,t)=>{let r;return(...o)=>{clearTimeout(r),r=setTimeout((()=>{e(...o)}),t)}},truncateString=(e,t=50)=>{if(e)return e.length>t?e.slice(0,t)+"...":e},getCommonData=()=>({page:window.location.protocol+"//"+window.location.host+window.location.pathname,pageWithParams:window.location.href,createdAt:(new Date).toISOString(),ver:"0.0.2"}),Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,r,o,a,n,i,c,d="",l=0;for(e=Base64._utf8_encode(e);l<e.length;)a=(t=e.charCodeAt(l++))>>2,n=(3&t)<<4|(r=e.charCodeAt(l++))>>4,i=(15&r)<<2|(o=e.charCodeAt(l++))>>6,c=63&o,isNaN(r)?i=c=64:isNaN(o)&&(c=64),d=d+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(i)+this._keyStr.charAt(c);return d},_utf8_encode:function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var r=0;r<e.length;r++){var o=e.charCodeAt(r);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}},defaultConfig={autoCapture:{all:!0,click:!0,scroll:!0,view:!0},endpoint:"productionUrl"};let cQue=[],cListnr=!1;const addPageView=throttle((()=>{cQue.push({type:"view",data:{screenSize:{width:window.screen.width,height:window.screen.height},windowSize:{width:window.innerWidth,height:window.innerHeight},referrer:document.referrer,...getCommonData()}})}),1e3);export const initProject=(e="",t={})=>{const r={...defaultConfig,...t};"undefined"!=typeof window&&(r.autoCapture.view&&r.autoCapture.all&&addPageView(),cListnr||(r.autoCapture.click&&r.autoCapture.all&&document.addEventListener("click",throttle((({target:e})=>{switch(e?.tagName){case"A":cQue.push({type:"lCl",data:{link:e.href,text:truncateString(e.innerText),id:e.id||void 0},...getCommonData()});break;case"BUTTON":cQue.push({type:"bCl",data:{text:truncateString(e.innerText),id:e.id||void 0},...getCommonData()});break;default:cQue.push({type:"Cl",data:{elementType:e.tagName,alt:e.alt||void 0,text:truncateString(e.innerText)||void 0,id:e.id||void 0},...getCommonData()})}}),100)),r.autoCapture.scroll&&r.autoCapture.all&&document.addEventListener("scroll",debounce((()=>{cQue.push({type:"scroll",data:{scrollY:window.scrollY,scrollX:window.scrollX},...getCommonData()})}),1e3)),cListnr=!0,setInterval((()=>{if(!cQue.length)return;let e;try{e=Base64.encode(JSON.stringify({payload:cQue,projectId:1234}))}catch(e){return void console.error("Project Failed to encode data, make sure custom events data values are strings or numbers",e)}e.length>5e3?console.error("Project Data too large to send, reduce custom events payload size"):(fetch(r.endpoint,{method:"POST",headers:{"Content-Type":"application/string"},body:e}).catch((e=>{console.error("Failed to send data",e)})),cQue=[])}),5e3)))};export const sendEvent=(e,t)=>{if("undefined"!=typeof window){if(!cListnr)throw new Error("Call initProject first");cQue.push({type:"custm",name:e,data:t,...getCommonData()})}};